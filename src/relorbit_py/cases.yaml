# src/relorbit_py/cases.yaml

suites:
  newton:
    description: "Newtonian 2-body planar validation cases (energy + angular momentum drift)."
    cases:
      - name: newton_circular_mu1_r1
        model: newton
        params:
          mu: 1.0
        # [x, y, vx, vy]
        state0: [1.0, 0.0, 0.0, 1.0]
        span: [0.0, 100.0]
        solver:
          dt: 1.0e-3
        criteria:
          energy_rel_drift_max: 1.0e-6
          h_rel_drift_max: 1.0e-8
          status: BOUND
          status_must_match_theory: true

      - name: newton_elliptic_mu1_r1_v0p8
        model: newton
        params:
          mu: 1.0
        # v < sqrt(mu/r)=1 => bound elliptic
        state0: [1.0, 0.0, 0.0, 0.8]
        span: [0.0, 200.0]
        solver:
          dt: 5.0e-4
        criteria:
          energy_rel_drift_max: 2.0e-6
          h_rel_drift_max: 2.0e-8
          status: BOUND
          status_must_match_theory: true

      - name: newton_hyperbolic_mu1_r1_v1p6
        model: newton
        params:
          mu: 1.0
        # v > 1 => unbound (hyperbolic)
        state0: [1.0, 0.0, 0.0, 1.6]
        span: [0.0, 20.0]
        solver:
          dt: 1.0e-4
        criteria:
          energy_rel_drift_max: 2.0e-6
          h_rel_drift_max: 2.0e-8
          status: UNBOUND
          status_must_match_theory: true

  schwarzschild:
    description: "Schwarzschild equatorial (geodesics) validation cases using (M,E,L,r0,phi0,pr0)."
    cases:
      # ---------------------------
      # Circular (3 dts) — mesmo físico, dt diferente
      # ---------------------------
      - name: schwarzschild_circular_M1_r10_dt1e3
        model: schwarzschild
        params:
          M: 1.0
          E: 0.9561828874675149
          L: 3.779644730092272
          capture_r: 2.5
          capture_eps: 1.0e-12
        state0: [10.0, 0.0]   # [r0, phi0]
        span: [0.0, 200.0]    # [tau0, tauf]
        solver:
          dt: 1.0e-3
        criteria:
          status: BOUND
          constraint_abs_max: 1.0e-10
          r_max_dev: 1.0e-3
          min_events: 0

      - name: schwarzschild_circular_M1_r10_dt5e4
        model: schwarzschild
        params:
          M: 1.0
          E: 0.9561828874675149
          L: 3.779644730092272
          capture_r: 2.5
          capture_eps: 1.0e-12
        state0: [10.0, 0.0]
        span: [0.0, 200.0]
        solver:
          dt: 5.0e-4
        criteria:
          status: BOUND
          constraint_abs_max: 1.0e-10
          r_max_dev: 1.0e-3
          min_events: 0

      - name: schwarzschild_circular_M1_r10_dt2p5e4
        model: schwarzschild
        params:
          M: 1.0
          E: 0.9561828874675149
          L: 3.779644730092272
          capture_r: 2.5
          capture_eps: 1.0e-12
        state0: [10.0, 0.0]
        span: [0.0, 200.0]
        solver:
          dt: 2.5e-4
        criteria:
          status: BOUND
          constraint_abs_max: 1.0e-10
          r_max_dev: 1.0e-3
          min_events: 0

      # ---------------------------
      # Bound w/ turning points (3 dts) — mesmo físico, dt diferente
      # Esperado: pr muda de sinal => eventos periapse/apoapse
      # Aqui exigimos pelo menos um periapse.
      # ---------------------------
      - name: schwarzschild_bound_turning_M1_r12_dt1e3
        model: schwarzschild
        params:
          M: 1.0
          E: 0.97
          L: 4.0
          capture_r: 2.5
          capture_eps: 1.0e-12
        pr0: -0.12236859921595049   # consistente: pr0^2 = E^2 - Veff(r0)
        state0: [12.0, 0.0]
        span: [0.0, 200.0]
        solver:
          dt: 1.0e-3
        criteria:
          status: BOUND
          constraint_abs_max: 1.0e-8
          r_max_dev: null
          must_have_events: ["periapse"]

      - name: schwarzschild_bound_turning_M1_r12_dt5e4
        model: schwarzschild
        params:
          M: 1.0
          E: 0.97
          L: 4.0
          capture_r: 2.5
          capture_eps: 1.0e-12
        pr0: -0.12236859921595049
        state0: [12.0, 0.0]
        span: [0.0, 200.0]
        solver:
          dt: 5.0e-4
        criteria:
          status: BOUND
          constraint_abs_max: 1.0e-8
          r_max_dev: null
          must_have_events: ["periapse"]

      - name: schwarzschild_bound_turning_M1_r12_dt2p5e4
        model: schwarzschild
        params:
          M: 1.0
          E: 0.97
          L: 4.0
          capture_r: 2.5
          capture_eps: 1.0e-12
        pr0: -0.12236859921595049
        state0: [12.0, 0.0]
        span: [0.0, 200.0]
        solver:
          dt: 2.5e-4
        criteria:
          status: BOUND
          constraint_abs_max: 1.0e-8
          r_max_dev: null
          must_have_events: ["periapse"]

      # ---------------------------
      # Plunge/Capture (3 dts) — mesmo físico, dt diferente
      # Teu C++ define CAPTURE como cruzar r_cap = capture_r*M.
      # Então exigimos evento "capture".
      # ---------------------------
      - name: schwarzschild_plunge_M1_r5p8_dt5e4
        model: schwarzschild
        params:
          M: 1.0
          E: 0.9431662428100122
          L: 3.466162967069742
          capture_r: 2.5
          capture_eps: 1.0e-12
        pr0: -0.02            # inbound
        state0: [5.8, 0.0]
        span: [0.0, 200.0]
        solver:
          dt: 5.0e-4
        criteria:
          status: CAPTURE
          constraint_abs_max: 1.0e-8
          r_max_dev: null
          must_have_events: ["capture"]

      - name: schwarzschild_plunge_M1_r5p8_dt2p5e4
        model: schwarzschild
        params:
          M: 1.0
          E: 0.9431662428100122
          L: 3.466162967069742
          capture_r: 2.5
          capture_eps: 1.0e-12
        pr0: -0.02
        state0: [5.8, 0.0]
        span: [0.0, 200.0]
        solver:
          dt: 2.5e-4
        criteria:
          status: CAPTURE
          constraint_abs_max: 1.0e-8
          r_max_dev: null
          must_have_events: ["capture"]

      - name: schwarzschild_plunge_M1_r5p8_dt1p25e4
        model: schwarzschild
        params:
          M: 1.0
          E: 0.9431662428100122
          L: 3.466162967069742
          capture_r: 2.5
          capture_eps: 1.0e-12
        pr0: -0.02
        state0: [5.8, 0.0]
        span: [0.0, 200.0]
        solver:
          dt: 1.25e-4
        criteria:
          status: CAPTURE
          constraint_abs_max: 1.0e-8
          r_max_dev: null
          must_have_events: ["capture"]
